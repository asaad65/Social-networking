<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/index.css">
    <title>Document</title>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
                  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
   <nav class="container-lg rounded-bottom-3 d-flex align-items-center justify-content-between p-3 bg-primary">
    <div class="d-flex gap-3 align-items-center">
       <h2><a href="/Social-networking/" style="text-decoration: none; color: white;">Home</a></h2>
         <div id="Showuser">

        </div>
    </div>
   <div id="mood_user">
   
   </div>
 </nav>
    <div id="user_ditiles">
        
    </div>
      <div id = "spinnerWrapper"></div>
    <div id="Posts">

    </div>
      <div id="ShowAddPostId" data-bs-toggle="modal" data-bs-target="#AddPostId">

      </div>
    <!-- Modal Login  -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorLogin" class="text-danger text-center"></span>
      <div class="modal-body">
        <input id="usernameLogin" type="text" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="username">
        <input id="passwordLogin" type="password"class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="password">
        
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" onclick="Login()" id="loginButton" class=" btn btn-primary">Login</button>
      </div>
    </div>
  </div>
</div>
  <!-- Modal Register  -->
<div class="modal fade" id="myModalRegister"  tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Register</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <div id="error_Register" class="text-danger text-center"></div>
      <div class="modal-body">
        <input type="text" id="Register_name" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="name">
        <input type="text" id="Register_username" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="username">
        <input type="password" id="Register_password" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="password">
        <input type="email" id="Register_email" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="email">
         <label for="Register_file" class="w-100 mt-3 d-block">
            <div class="p-2 rounded-2 border-2 border-primary text-center bg-primary text-light fw-bold cursor-pointer" style="transition: 0.3s; outline: none;">
            Choose a file üìÅ
            </div> 
          </label>
        <input type="file" id="Register_file" class="d-none">

        
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" id="RegisterButton" onclick="Register()">Register</button>
      </div>
    </div>
  </div>
</div>
   <!-- Modal AddPost  -->
<div class="modal fade" id="AddPostId" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Add Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorAddPost" class="text-danger text-center"></span>
      <div class="modal-body">
        <input type="text" id="title" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="title">
        <input type="body" id="body" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="body">
          <label for="img" class="w-100 mt-3 d-block">
            <div class="p-2 rounded-2 border-2 border-primary text-center bg-primary text-light fw-bold cursor-pointer" style="transition: 0.3s; outline: none;">
            Choose a file üìÅ
            </div> 
          </label>
        <input type="file" id="img" class="d-none">
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" id="Add" onclick="AddPost()">Add</button>
      </div>
    </div>
  </div>
</div>
 <!-- Modal EditePost  -->
<div class="modal fade" id="EditePost" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Edite Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorAddPost" class="text-danger text-center"></span>
      <div class="modal-body">
        <input type="text" id="Editetitle" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="title">
        <input type="body" id="Editebody" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="body">
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" id="Edit" onclick="EditePost()">Edit</button>
      </div>
    </div>
  </div>
</div>
</body>
<script src="./main.js"></script>
<script>
  
const user_ditiles = document.querySelector('#user_ditiles');
const url = new URLSearchParams(window.location.search);
const id = url.get('userId');

async function fetchUserDetails() {
  Loader(true)
  try {
    const response = await axios.get(`https://tarmeezacademy.com/api/v1/users/${id}`);
    Loader(false)
  
     const author = response.data.data;
    let img = typeof author.profile_image === 'object' ? 'imegs/user.png' : author.profile_image;

    user_ditiles.innerHTML = `
     

       <div class="container my-5">
        <div class="row bg-white shadow rounded-4 p-4 align-items-center justify-content-center g-4">
          <div class="col-auto">
            <img
              src="${img}"
              alt="User Profile"
              class="rounded-circle border border-primary"
              style="width: 180px; height: 180px; object-fit: cover;"
            />
          </div>
          <div class="col-md-5 text-md-start text-center">
            <ul class="list-unstyled mb-0">
              <li class="mb-2 fs-3"><strong>name: </strong>${author.name}</li>
              <li class="mb-2 fs-3"><strong>email: </strong>${author.email}</li>
              <li class="fs-3"><strong>username:</strong> ${author.username}</li>
            </ul>
          </div>
          <div class="col-md-4 ">
            <div class="mb-3 d-flex gap-2">
              <span class="text-primary fw-bold fs-2">comments</span>
              <div class=" text-secondary fs-2">${author.comments_count}</div>
            </div>
            <div class="d-flex gap-2">
              <span class="text-primary fw-bold fs-2">posts</span>
              <div class=" text-secondary fs-2">${author.posts_count}</div>
            </div>
          </div>
        </div>
      </div>
    `;
  } catch (error) {
    Loader(false)
    user_ditiles.innerHTML = `
     <div class='d-flex container  justify-content-center align-items-center mt-2'>
           <div class=" alert alert-danger d-flex w-100  justify-content-center align-items-center ">${erore}</div>
     </div>
    `;
  }
}

fetchUserDetails();

async function loadUserPosts() {

  Loader(true)
  try {
    const Posts = document.querySelector('#Posts')
    const response = await axios.get(`https://tarmeezacademy.com/api/v1/users/${id}/posts`)
    Loader(false)
    let postHTml = ''
    const dataPosts = response.data.data
      console.log('response')
    console.log(dataPosts)

    dataPosts.map(post => {
      console.log('post')
      console.log(post)
      let img = typeof post.author.profile_image === 'object' ? 'imegs/user.png' : post.author.profile_image
      let title =  post.title == null ? '' : post.title
      let body =  post.body == null ? '' : post.body
      postHTml += `
        <div class="Post">
          <div class="container my-4">
            <div class="card shadow-lg mx-auto" style="max-width: 768px;">
              <!-- Header -->
              <div class="d-flex align-items-center gap-3 rounded-top-circle p-3 bg-light border-bottom">
                <a href="/Social-networking/user.html?userId=${post.author.id}">
                  <img src="${img}" alt="User" class="rounded-circle" width="48" height="48" />
                </a>
                <a href="/Social-networking/user.html?userId=${post.author.id}" class="text-decoration-none username-hover">
                  <strong>${post.author.username}</strong>
                </a>
                <div class="ms-auto">
            ${JSON.parse(localStorage.getItem('user'))?post.author.id == JSON.parse(localStorage.getItem('user')).user.id?`<button class="btn btn-sm btn-outline-secondary me-1" data-bs-toggle="modal" data-bs-target="#EditePost" onclick="IdButton(${post.id}, '${title}', '${body}')">Edit</button>`:'':''}
           ${JSON.parse(localStorage.getItem('user'))?post.author.id == JSON.parse(localStorage.getItem('user')).user.id?` <button class="btn btn-sm btn-outline-danger"  onclick="DeletPost(${post.id})" >Delete</button>`:'':''}
        </div>
              </div>

              ${typeof post.image === 'object' ? '' : `<img class="card-img-top" src="${post.image}" alt="Post Image">`}

              <!-- Post Content -->
              <div class="card-body">
                <p class="text-muted mb-1">${post.created_at}</p>
                <h5 class="card-title">${title}</h5>
                <p class="card-text">${body}</p>
              </div>

              <!-- Comments Footer -->
              <a href="/Social-networking/PostDetails.html?PostId=${post.id}" class="text-decoration-none">
                <div class="bg-secondary text-white p-2 d-flex justify-content-between align-items-center">
                  <h6 class="mb-0">Comments</h6>
                  ${
                    post.comments_count === 0
                      ? `<div></div>`
                      : `<span class="bg-primary rounded-circle d-inline-block text-center text-white" style="width: 28px; height: 28px; line-height: 28px;">+${post.comments_count}</span>`
                  }
                </div>
              </a>
            </div>
          </div>
        </div>
      `
    })

    Posts.innerHTML = postHTml
  } catch (error) {
     Loader(false)
     console.log(error)
    Posts.innerHTML = 
    `
       <div class='d-flex container  justify-content-center align-items-center mt-2'>
           <div class=" alert alert-danger d-flex w-100  justify-content-center align-items-center "> ${error}</div>
       </div>
    `
  }
}
loadUserPosts()
</script>
</html>