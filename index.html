<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <link rel="stylesheet" href="./index.css?v=1">         
      <title>Document</title>
          <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
 <nav class="container-lg rounded-bottom-3 d-flex align-items-center justify-content-between p-3 bg-primary">
    <div class="d-flex gap-3 align-items-center">
       <h2><a href="/" style="text-decoration: none; color: white;">Home</a></h2>
         <div id="Showuser">
          
        </div>
    </div>
   <div id="mood_user">
   
   </div>
 </nav>
 
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">

</div>



  <section class="container-sm" id="Posts">


  </section>
  <div id="ShowAddPostId" data-bs-toggle="modal" data-bs-target="#AddPostId">

  </div>
  <div id = "Loader"></div>
  <!-- Modal Login  -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorLogin" class="text-danger text-center"></span>
      <div class="modal-body">
        <input id="usernameLogin" type="text" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="username">
        <input id="passwordLogin" type="password"class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="password">
        
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" onclick="Login()" id="loginButton" class=" btn btn-primary">Login</button>
      </div>
    </div>
  </div>
</div>
  <!-- Modal Register  -->
<div class="modal fade" id="myModalRegister"  tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Register</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <div id="error_Register" class="text-danger text-center"></div>
      <div class="modal-body">
        <input type="text" id="Register_name" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="name">
        <input type="text" id="Register_username" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="username">
        <input type="password" id="Register_password" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="password">
        <input type="email" id="Register_email" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="email">
         <label for="Register_file" class="w-100 mt-3 d-block">
            <div class="p-2 rounded-2 border-2 border-primary text-center bg-primary text-light fw-bold cursor-pointer" style="transition: 0.3s; outline: none;">
            Choose a file üìÅ
            </div> 
          </label>
        <input type="file" id="Register_file" class="d-none">

        
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" onclick="Register()" id="RegisterButton">Register</button>
      </div>
    </div>
  </div>
</div>
   <!-- Modal AddPost  -->
<div class="modal fade" id="AddPostId" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Add Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorAddPost" class="text-danger text-center"></span>
      <div class="modal-body">
        <input type="text" id="title" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="title">
        <input type="body" id="body" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="body">
          <label for="img" class="w-100 mt-3 d-block">
            <div class="p-2 rounded-2 border-2 border-primary text-center bg-primary text-light fw-bold cursor-pointer" style="transition: 0.3s; outline: none;">
            Choose a file üìÅ
            </div> 
          </label>
        <input type="file" id="img" class="d-none">
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" id="Add" onclick="AddPost()">Add</button>
      </div>
    </div>
  </div>
</div>
 <!-- Modal EditePost  -->
<div class="modal fade" id="EditePost" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"> Edite Post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="cansel"></button>
      </div>
      <span id="errorAddPost" class="text-danger text-center"></span>
      <div class="modal-body">
        <input type="text" id="Editetitle" class="w-100 p-2 rounded-2 border-2 border-primary" style="outline: none;" placeholder="title">
        <input type="body" id="Editebody" class="w-100 p-2 rounded-2 border-2 border-primary mt-3" style="outline: none;" placeholder="body">
      </div>
      <div class="modal-footer" style="direction: rtl;">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">cansel</button>
        <button type="button" class=" btn btn-primary" id="Edit" onclick="EditePost()">Edit</button>
      </div>
    </div>
  </div>
</div>
</body>

<!-- Axios -->

<script src="/main.js"></script>
   <script>
    let last_page = 1
    const Posts = document.querySelector("#Posts")
     Posts.innerHTML = ''
    async function GetPost( numberPage = 1){
      console.log(numberPage)
      Loader(true)
      try{
         const response = await axios.get('https://tarmeezacademy.com/api/v1/posts?page='+numberPage)
    
     Loader(false)
    const post = response.data.data
    console.log(post)
     last_page = response.data.meta.last_page
    post.forEach(element => {
    let titel =  element.title == null ? '' : element.title
    let body =  element.body == null ? '' : element.body
    let img = typeof element.author.profile_image == 'object' ? 'imegs/user.png': element.author.profile_image
    let postId = element.id

    let p = `
           <div class="Post">
  
    <div class="container my-4">
    <div class="card shadow-lg mx-auto" style="max-width: 768px;">
      <!-- Header -->
      <div class="d-flex align-items-center gap-3 rounded-top-circle  p-3 bg-light border-bottom">
        <a href="/user.html?userId=${element.author.id}">
          <img src=${img} alt="User" class="rounded-circle" width="48" height="48" />
        </a>
        <a href="/user.html?userId=${element.author.id}" class="text-decoration-none username-hover">
          <strong>${element.author.username}</strong>
        </a>
        <div class="ms-auto">
            ${JSON.parse(localStorage.getItem('user'))?element.author.id == JSON.parse(localStorage.getItem('user')).user.id?`<button class="btn btn-sm btn-outline-secondary me-1"  data-bs-toggle="modal" data-bs-target="#EditePost" onclick="IdButton(${element.id}, '${titel}', '${body}')">Edit</button>`:'':''}
           ${JSON.parse(localStorage.getItem('user'))?element.author.id == JSON.parse(localStorage.getItem('user')).user.id?` <button class="btn btn-sm btn-outline-danger" onclick="DeletPost(${element.id})">Delete</button>`:'':''}
        </div>
      </div>
     
      ${typeof element.image == 'object' ? '' : `<img class="card-img-top" src=${element.image} alt="Post Image">` }
      <!-- Post Content -->
      <div class="card-body">
        <p class="text-muted mb-1">${element.created_at}</p>
        <h5 class="card-title">${titel}</h5>
        <p class="card-text">${body}</p>
      </div>

      <!-- Comments Footer -->
      <a href="/PostDetails.html?PostId=${element.id}" class="text-decoration-none">
        <div class="bg-secondary text-white p-2 d-flex justify-content-between align-items-center">
          <h6 class="mb-0 text-white">Comments</h6>
          ${element.comments_count == 0 ?(
            `<div></div>`
          ):(
             `<span class="bg-primary rounded-circle d-inline-block text-center text-white" style="width: 28px; height: 28px; line-height: 28px;">${'+' + element.comments_count}</span>`
          )}
          
        </div>
      </a>
    </div>
  </div>
  </div>
    `
    Posts.innerHTML += p
  
   
    });
  } catch(error){
    Loader(false)
    Posts.innerHTML = `
      <div class='d-flex container  justify-content-center align-items-center mt-2'>
           <div class=" alert alert-danger d-flex w-100  justify-content-center align-items-center "> ${erore}</div>
      </div>
    `
  }
   
    }
       GetPost()
       let numberPage = 1
    window.addEventListener('scroll',function(){
    const scrol = window.scrollY + window.innerHeight >= document.documentElement.scrollHeight -300
    if(scrol && numberPage <= last_page ){
    numberPage += 1
     GetPost(numberPage)
    }
    })


  



   </script>    
</html>